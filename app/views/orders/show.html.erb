<h1 class="center-text">Shopping list</h1>


<%# Pop-up %>
<div class = "maincontainer">

  <div data-controller="order-show">
  <div data-controller="sticky-headers">

  <div class = btn-div>
    <button class="btn-list-icon-active" data-action="click->order-show#categorise"  data-order-show-target = "categoryIcon">
      <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-archive" viewBox="0 0 16 16">
        <path d="M0 2a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1v7.5a2.5 2.5 0 0 1-2.5 2.5h-9A2.5 2.5 0 0 1 1 12.5V5a1 1 0 0 1-1-1V2zm2 3v7.5A1.5 1.5 0 0 0 3.5 14h9a1.5 1.5 0 0 0 1.5-1.5V5H2zm13-3H1v2h14V2zM5 7.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5z"/>
      </svg>
    </button>
    <button class="btn-list-icon" data-action="click->order-show#az" data-order-show-target = "azIcon">
      <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-sort-alpha-down" viewBox="0 0 16 16">
        <path fill-rule="evenodd" d="M10.082 5.629 9.664 7H8.598l1.789-5.332h1.234L13.402 7h-1.12l-.419-1.371h-1.781zm1.57-.785L11 2.687h-.047l-.652 2.157h1.351z"/>
        <path d="M12.96 14H9.028v-.691l2.579-3.72v-.054H9.098v-.867h3.785v.691l-2.567 3.72v.054h2.645V14zM4.5 2.5a.5.5 0 0 0-1 0v9.793l-1.146-1.147a.5.5 0 0 0-.708.708l2 1.999.007.007a.497.497 0 0 0 .7-.006l2-2a.5.5 0 0 0-.707-.708L4.5 12.293V2.5z"/>
      </svg>
      </button>
    <button class="btn-list-icon" data-action="click->order-show#za" data-order-show-target = "zaIcon"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-sort-alpha-down-alt" viewBox="0 0 16 16">
    <path d="M12.96 7H9.028v-.691l2.579-3.72v-.054H9.098v-.867h3.785v.691l-2.567 3.72v.054h2.645V7z"/>
    <path fill-rule="evenodd" d="M10.082 12.629 9.664 14H8.598l1.789-5.332h1.234L13.402 14h-1.12l-.419-1.371h-1.781zm1.57-.785L11 9.688h-.047l-.652 2.156h1.351z"/>
    <path d="M4.5 2.5a.5.5 0 0 0-1 0v9.793l-1.146-1.147a.5.5 0 0 0-.708.708l2 1.999.007.007a.497.497 0 0 0 .7-.006l2-2a.5.5 0 0 0-.707-.708L4.5 12.293V2.5z"/>
    </svg></button>
    <button class="btn-list-icon" data-action="click->order-show#list" data-order-show-target = "listIcon"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-view-stacked" viewBox="0 0 16 16">
    <path d="M3 0h10a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2zm0 1a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H3zm0 8h10a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2zm0 1a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1H3z"/>
    </svg></button>
    <button class="btn-list-icon" data-action="click->order-show#split" data-order-show-target = "splitIcon"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-currency-pound" viewBox="0 0 16 16">
    <path d="M4 8.585h1.969c.115.465.186.939.186 1.43 0 1.385-.736 2.496-2.075 2.771V14H12v-1.24H6.492v-.129c.825-.525 1.135-1.446 1.135-2.694 0-.465-.07-.913-.168-1.352h3.29v-.972H7.22c-.186-.723-.372-1.455-.372-2.247 0-1.274 1.047-2.066 2.58-2.066a5.32 5.32 0 0 1 2.103.465V2.456A5.629 5.629 0 0 0 9.348 2C6.865 2 5.322 3.291 5.322 5.366c0 .775.195 1.515.399 2.247H4v.972z"/>
    </svg></button>
  </div>

    <%# list by category %>

  <% if @items_category.empty? %>
    <p>please create a list</p>
  <% else %>
    <div class="" data-order-show-target="category">
      <div class= "categoryHeader1 category-box-shadow" data-order-show-target="stickyTop">
        <%= @items_category[0].category%>
      </div>
      <div class = "item-container item-box-shadow">
        <div class = "item-name">
          <%= @items_category[0].name%>
        </div>
        <div class = "item-unit">
          <%= @items_category[0].quantity%><%=@items_category[0].unit%>
        </div>
        <div class = "item-tickbox">
          <%= link_to mark_as_done_path(@items_category[0]) do%>
            <input class="form-check-input" type="checkbox" id="checkboxNoLabel" value="" aria-label="...">
          <% end %>
        </div>
      </div>
          <% @items_category.each_cons(2) do |item| %>
            <% if item[0].category != item[1].category%>
            <div class= "categoryHeader2 category-box-shadow">
              <%= item[1].category %>
            </div>
          <% end %>
      <div class = "item-container item-box-shadow">
        <div class = "item name">
          <%=item[1].name%>
        </div>
        <div class = "item-unit">
          <%= item[1].quantity%><%=item[1].unit%>
        </div>
        <div class = "item-tickbox">
          <%= link_to mark_as_done_path(item[1]) do%>
            <div>
              <input class="form-check-input" type="checkbox" id="checkboxNoLabel" value="" aria-label="...">
            </div>
          <% end %>
        </div>
      </div>
        <% end %>
    </div>


      <%# list by a-z %>
      <div class="hide-content" data-order-show-target="az">
      <div class= "categoryHeader2 category-box-shadow" data-order-show-target="stickyTop">
        A-Z
      </div>
        <% @items_az.each do |item| %>
          <div class = "item-container item-box-shadow">
            <div class = "item-name">
              <%=item.name%>
            </div>
            <div class = "item-unit">
              <%= item.quantity%><%=item.unit%>
            </div>
            <div class = "item-tickbox">
              <%= link_to mark_as_done_path(item) do%>
                <input class="form-check-input" type="checkbox" id="checkboxNoLabel" value="" aria-label="...">
              <% end %>
            </div>
          </div>
        <% end %>
      </div>

    <%# <%= link_to household_path(@household), class: "text-decoration-none" do %>


      <%# list by z-a %>
      <div class="hide-content" data-order-show-target="za">
        <div class= "categoryHeader2 category-box-shadow" data-order-show-target="stickyTop">
          Z-A
        </div>
        <% @items_za.each do |item| %>
          <div class = "item-container item-box-shadow">
            <div class = "item-name">
              <%=item.name%>
            </div>
            <div class = "item-unit">
              <%= item.quantity%><%=item.unit%>
            </div>
            <div class = "item-tickbox">
              <%= link_to mark_as_done_path(item) do%>
                <input class="form-check-input" type="checkbox" id="checkboxNoLabel" value="" aria-label="...">
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>

      <%# list of lists %>
      <div class="hide-content" data-order-show-target="list">
        <table class="table table-format">
          <div class= "categoryHeader2 category-box-shadow" data-order-show-target="stickyTop">
            Order lists
          </div>

            <% @lists.each do |list| %>
            <%# TODO: link lists to relevant list using @list_path(list) %>
            <%# test %>
                <div class = "item-container item-box-shadow" >
                  <div class = "item-name">
                    <%=list.title%>
                  </div>
                  <div class = "item-unit">
                    <%= list.user.name%>
                  </div>
                  <% if list.user ==  current_user%>
                  <div class = "item-tickbox">
                    <%= link_to user_list_path(list.user, list) do %>
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil" viewBox="0 0 16 16">
                        <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z"/>
                      </svg>
                  <% end %>
                  </div>
                </div>
                <% end %>
            <% end %>
        </table>
      </div>

      <%# user cost breakdown %>

      <div class="hide-content" data-order-show-target="split">
        <div class= "categoryHeader2 category-box-shadow" data-order-show-target="stickyTop">
          Estimated amount owed
        </div>
        <div class = "item-container item-box-shadow" >
          <% @all_items_by_user.each do |array| %>
            <div class = "item-name-1">
              <%=array[0].name%>
            </div>
            <% total_price = 0 %>
            <% array[1].each { |item|  total_price += item.price} %>
            <div class = "item-owed">
              Â£<%= total_price.to_f%>
            </div>
        <% end %>
        </div>
        <%# button code here %>

      <div class = "btn-container">
        <%= link_to household_map_path(@household), class:'text-decoration-none' do %>
          <div class="btn-main-green  text-decoration-none">
            Let's shop
          </div>
        <% end %>
      </div>
      <div class="btn-container">
        <%= link_to household_path(@household), class:'text-decoration-none' do %>
          <div class="btn-main-blue  text-decoration-none">
            Back to Household
          </div>
        <% end %>
      </div>
  <p>
    <% unless @done_items.empty? %>
      <a class="" data-bs-toggle="collapse" href="#collapseExample" role="button" aria-expanded="false" aria-controls="collapseExample">
        <div class = "center mb-3">
          Completed items
        </div>
      </a>
      <div class="collapse.show collapse show" id="collapseExample">
        <% @done_items.each do |item| %>
          <div class = "item-container checked-text item-box-shadow">
            <div class = "item-name checked">
              <%=item.name%>
            </div>
            <div class = "item-unit checked-text">
              <%= item.quantity%><%=item.unit%>
            </div>
            <div class = "item-tickbox">
              <%= link_to mark_as_done_path(item) do%>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="" id="flexCheckChecked" checked>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>

    <% else %>
    <% end %>
  </div>
  </div>
  </div>
  </div>
</div>
